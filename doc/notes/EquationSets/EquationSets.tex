\clearemptydoublepage
\chapter{Equation Sets}
\label{cha:equationsets}

\section{Elasticity Class}

\subsection{Linear Elasticity}

Finite element formulation of linear elasticity problems is

\subsection{Finite Elasticity}

Formulation of finite element equations for finite elasticity (large deformation mechanics) implemented in OpenCMISS is based on the 
\textit{\textbf{principle of virtual work}}. The finite element model consists of a set of non-linear algebraic equations. Non-linearity of 
equations stems from non-linear stress-strain relationship and quadratic terms present in the strain tensor. A typical problem in large deformation 
mechanics involves determination of the deformed geometry or mesh nodal parameters, from the finite element point of view, of the continuum 
from a known undeformed geometry, subject to boundary conditions and satisfying stress-strain (constitutive) relationship. 
  
The boundary conditions can be either \textit{\textbf{Dirichlet}} (displacement), \textit{\textbf{Neumann}} (force) or a combination of them, known 
as the mixed boundary conditions. Displacement boundary conditions are generally nodal based. However, force boundary conditions can take 
any of the following forms or a combination of them - nodal-based, distributed load (e.g. pressure) or force acting at a discrete point 
on the boundary. In the latter two forms, the equivalent nodal forces are determined using the \textit{\textbf{method of work equivalence}} 
\cite{hutton:2004} and the forces so obtained will then be added to the right hand side or the residual vector of the linear equation system.  

There are a numerous ways of describing the mechanical characteristics of deformable materials in large deformation mechanics or finite elasticity
analyses. A predominantly used form for representing constitutive properties is a strain energy density function. This model gives the energy 
required to deform a unit volume (hence energy density) of the deformable continuum as a function of Green-Lagrange strain tensor components or its 
derived variables such as invariants or principal stretches. A material that has a strain energy density function is known as a 
\textit{\textbf{hyperelastic}} or \textit{\textbf{Green-elastic material}}. 

The deformed equilibrium state should also give the minimum total elastic potential energy. One can therefore formulate finite element equations 
using the \textit{\textbf{Variational method}} approach where an extremum of a functional (in this case total strain energy) is determined to 
obtain mesh nodal parameters of the deformed continuum. It is also possible to derive the finite element equations starting from the governing
equilibrium equations known as Cauchy equation of motion. The weak form of the governing equations is obtained by multiplying them with suitable
weighting functions and integrating over the domain (method of weighted residuals). If interpolation or shape functions are used as weighting 
functions, then the method is called the Galerkin finite element method. All three approaches (virtual work, variational method and 
Galerkin formulation) result in the same finite element equations.     

In the following sections the derivation of kinematic relationships of deformation, energy conjugacy, constitutive relationships and final form 
the finite element equations using the virtual work approach will be discussed in detail.

\subsubsection{Kinematics of Deformation}
In order to track the deformation of an infinitesimal length at a particle of the continuum, two coordinates systems are defined. An arbitrary
orthogonal spatial coordinate system, which is fixed in space and a material coordinate system which is attached to the continuum and deforms 
with the continuum. The material coordinate system, in general, is a curvi-linear coordinate system but must have mutually orthogonal axes at the
undeformed state. However, in the deformed state, these axes are no longer orthogonal as they deform with the continuum (fig 1). In addition
to these coordinate systems, there exist finite element coordinate systems (one for each element) as well. These coordinates are normalised and 
vary from 0.0 to 1.0. The following notations are used to represent various coordinate systems and coordinates of a particle of the continuum.\\

\noindent $Y_{1}$-$Y_{2}$-$Y_{3}$ - fixed spatial coordinate system axes - orthogonal\\
$N_{1}$-$N_{2}$-$N_{3}$ - deforming material coordinate system axes  - orthogonal in the undeformed state\\
$\Xi_{1}$-$\Xi_{2}$-$\Xi_{3}$ - element coordinate system - non-orthogonal in general and deforms with continuum\\

\noindent $x_{1}$-$x_{2}$-$x_{3}$ [$\vect{x}$] - spatial coordinates of a particle in the undeformed state wrt $Y_{1}$-$Y_{2}$-$Y_{3}$ CS \\
$z_{1}$-$z_{2}$-$z_{3}$ [$\vect{z}$] - spatial coordinates of the same particle in the deformed state wrt $Y_{1}$-$Y_{2}$-$Y_{3}$ CS \\ 
$\nu_{1}$-$\nu_{2}$-$\nu_{3}$ [$\vect{\nu}$] - material coordinates of the particle wrt $N_{1}$-$N_{2}$-$N_{3}$ CS (these do not change) \\
$\xi_{1}$-$\xi_{2}$-$\xi_{3}$ [$\vect{\xi}$] - element coordinates of the particle wrt $\Xi_{1}$-$\Xi_{2}$-$\Xi_{3}$ CS (these too do not change)\\

Since the directional vectors of the material coordinate system at any given point in the undeformed state is mutually orthogonal, the 
relationship between spatial $\vect{x}$ and material $\vect{\nu}$ coordinates is simply a rotation. The user must define the undeformed 
material coordinate system. Typically a nodal based interpolatable field known as fibre information (fibre, imbrication and sheet angles) 
is input to OpenCMISS. These angles define how much the \textit{\textbf{reference or default material coordinate system}} must be rotated about 
the reference material axes. The reference material coordinate system at a given point is defined as follows. The first direction $\nu_{1}$ is 
in the $\xi_{1}$ direction. The second direction, $\nu_{2}$ is in the $\xi_{1}-\xi_{2}$ plane but orthogonal to $\nu_{1}$. Finally the third 
direction $\nu_{3}$ is determined to be normal to both $\nu_{1}$ and $\nu_{2}$. Once the reference coordinate system is defined, it is then rotated 
about $\nu_{3}$ by an angle equal to the interpolated fibre value at the point in counter-clock wise direction. This will be followed by a rotation 
about new $\nu_{2}$ axis again in the counter-clock wise direction by an angle equal to the sheet value. The final rotation is performed about the 
current $\nu_{1}$ by an angle defined by interpolated sheet value. Note that before a rotation is carried out about an arbitrary axis one must first 
align(transform) the axis of rotation with one of the spatial coordinate system axes. Once the rotation is done, the rotated coordinate 
system (material) must be inverse-transformed. 

Having defined the undeformed orthogonal material coordinate system, the metric tensor $\delby{\vect{x}}{\vect{\nu}}$ can be determined. As mentioned,
the tensor $\delby{\vect{x}}{\vect{\nu}}$ contains rotation required to align material coordinate system with spatial coordinate system. This tensor
is therefore orthogonal. A similar metric tensor can be defined to relate the deformed coordinates $\vect{z}$ of the point to its material
coordinates $\vect{\nu}$. Note that the latter coordinates do not change as the continuum deforms and more importantly this tensor is not 
orthogonal as well. The metric tensor, $\delby{\vect{z}}{\vect{\nu}}$ is called the \textit{\textbf{deformation gradient tensor}} and denoted 
as $\matr{F}$.

\begin{equation}
  \matr{F}=\delby{\vect{z}}{\vect{\nu}}
  \label{eqn:deformationgradienttensor}
\end{equation}
 
It can be shown that the deformation gradient tensor contains rotation when an infinitesimal length $\vect{dr_{0}}$ in the undeformed state undergoes 
deformation. Since rotation does not contribute to any strain, it must be removed from the deformation gradient tensor. Any tensor can be decomposed 
into an orthogonal tensor and a symmetric tensor (known as polar decomposition). In other words, the same deformation can be achieved by first 
rotating $\vect{dr}$ and then stretching (shearing and scaling) or vice-verse. Thus, the deformation gradient tensor can be given by,

\begin{equation}
  \matr{F}=\delby{\vect{z}}{\vect{\nu}}=\matr{R}\matr{U}=\matr{V}\matr{R_{1}}
  \label{eqn:polardecomposition}
\end{equation}
 
The rotation present in the deformation gradient tensor can be removed either by right or left multiplication of $\matr{F}$. The resulting tensors 
lead to different strain measures. The right Cauchy deformation tensor $\matr{C}$ is obtained from,

\begin{equation}
  \matr{C}=\transpose{[\matr{R}\matr{U}]}[\matr{R}\matr{U}]=\transpose{\matr{U}}\transpose{\matr{R}}\matr{R}\matr{U}=\transpose{\matr{U}}\matr{U}
  \label{eqn:rightcauchy}
\end{equation}

Similarly the left Cauchy deformation tensor or the Finger tensor \matr{B} is obtained from the left multiplication of \matr{F},

\begin{equation}
  \matr{B}=[\matr{V}\matr{R_{1}}]\transpose{[\matr{V}\matr{R_{1}}]}=\matr{V}\matr{R_{1}}\transpose{\matr{R_{1}}}\transpose{\matr{V}}=\matr{V}\transpose{\matr{V}}
  \label{eqn:leftcauchy}
\end{equation}

\noindent Note that both $\matr{R}$ and $\matr{R_{1}}$ are orthogonal tensors and therefore satisfy the following condition,

\begin{equation}
  \transpose{\matr{R}}\matr{R}=\matr{R_{1}}\transpose{\matr{R_{1}}}=\matr{I}
  \label{eqn:orthoganality}
\end{equation}

Since there is no rotation present in both $\matr{C}$ and $\matr{B}$, they can be used to define suitable strain measures as follows,

\begin{equation}
  \matr{E}=\frac{1}{2}\pbrac{\transpose{\delby{\vect{z}}{\vect{\nu}}}\delby{\vect{z}}{\vect{\nu}}-
                       \transpose{\delby{\vect{x}}{\vect{\nu}}}\delby{\vect{x}}{\vect{\nu}}}=
	    \frac{1}{2}(\matr{C}-\matr{I})	       
  \label{eqn:greenstrain}
\end{equation}

\noindent and

\begin{equation}
  \vect{e}=\frac{1}{2}\bbrac{\pbrac{\delby{\vect{x}}{\vect{\nu}}\transpose{\delby{\vect{x}}{\vect{\nu}}}}^{-1}-
                             \pbrac{\delby{\vect{z}}{\vect{\nu}}\transpose{\delby{\vect{z}}{\vect{\nu}}}}^{-1}}=
			     \frac{1}{2}\pbrac{\matr{I}-\matr{B}^{-1}}  
  \label{eqn:almansistrain}
\end{equation}

\noindent where $\matr{E}$ and $\vect{e}$ are called Green and Almansi strain tensors respectively. 
Also note that $\delby{\vect{x}}{\vect{\nu}}$ is an orthogonal tensor. \\

It is now necessary to establish a relationship between strain and displacement. Referring to figure 1, 

\begin{equation}
  \vect{z}=\vect{x}-\vect{u}
  \label{eqn:displacement}
\end{equation}

\noindent where \vect{u} is the displacement vector. \\

\noindent Differentiating \eqnref{eqn:displacement} using the chain rule,

\begin{equation}
  \delby{\vect{z}}{\vect{\nu}}=\delby{\vect{x}}{\vect{\nu}}-\delby{\vect{u}}{\vect{x}}\delby{\vect{x}}{\vect{\nu}}=
                               \pbrac{\matr{I}-\delby{\vect{u}}{\vect{x}}}\delby{\vect{x}}{\vect{\nu}}  
  \label{eqn:displacementgradient}
\end{equation}

\noindent Substituting \eqnref{eqn:displacementgradient} into \eqnref{eqn:greenstrain},

\begin{equation}
  \matr{E}=\bbrac{\transpose{\delby{\vect{x}}{\vect{\nu}}}\transpose{\pbrac{\matr{I}-\delby{\vect{u}}{\vect{x}}}}
                  \pbrac{\matr{I}-\delby{\vect{u}}{\vect{x}}}\delby{\vect{x}}{\vect{\nu}}-\matr{I}}
  \label{eqn:greendisplacement1}
\end{equation}

\noindent Simplifying,

\begin{equation}
  \matr{E}=\transpose{\delby{\vect{x}}{\vect{\nu}}}
           \pbrac{\delby{\vect{u}}{\vect{x}}+\transpose{\delby{\vect{u}}{\vect{x}}}-
	   \transpose{\delby{\vect{u}}{\vect{x}}}\delby{\vect{u}}{\vect{x}}}
	   \delby{\vect{x}}{\vect{\nu}}
  \label{eqn:greendisplacement2}
\end{equation}
 
As can be seen from \eqnref{eqn:greendisplacement2} the displacement gradient tensor $\delby{\vect{u}}{\vect{x}}$ is defined with respect to 
undeformed coordinates $\vect{x}$. This means that the strain tensor $\matr{E}$ has Lagrangian description and hence it is also also called 
the Green-Lagrange strain tensor. 
 
A similar derivation can be employed to establish a relationship between the Almansi and displacement gradient tensors and the final
form is given by,

\begin{equation}
  \vect{e}=\delby{\vect{u}}{\vect{z}}+\transpose{\delby{\vect{u}}{\vect{z}}}+
	   \transpose{\delby{\vect{u}}{\vect{z}}}\delby{\vect{u}}{\vect{z}}
  \label{eqn:almansidisplacement}
\end{equation}
 
The displacement gradient tensor terms in \eqnref{eqn:almansidisplacement} are defined with respect to deformed coordinates $\vect{z}$ and
therefore the strain tensor has Eulerian description. Thus it is also known as the Almansi-Euler strain tensor.

\subsubsection{Energy Conjugacy}



\subsubsection{Constitutive models}



\subsubsection{Principle of Virtual Work}
Elastic potential energy or simply elastic energy associated with the deformation can be given by strain and its energetically conjugate stress. 
Note that the Cauchy stress and Almansi-Euler strain tensors and Second Piola-Kirchhoff (2PK) and Green-Lagrange tensors are energetically 
conjugate. Thus, the \textit{\textbf{total internal energy}} due to strain in the body at the deformed state (fig. 3.1) can be given by,
 
\begin{equation}
  W_{int}=\gint{0}{v}{(\vect{e}:\vect{\sigma})}v
  \label{eqn:totalenergy}
\end{equation}

where \vect{e} and \vect{\sigma} are Almansi strain tensor and Cauchy stress tensor respectively.  

If the deformed body is further deformed by introducing virtual displacements, then the new internal elastic energy can be given by,

\begin{equation}
  {W_{int}+\delta W_{int}}=\gint{0}{v}{[\vect{(e+\delta{e})}:\vect{\sigma}]}v
  \label{eqn:virtualtotalenergy}
\end{equation}

Deducting \eqnref{eqn:totalenergy} from \eqnref{eqn:virtualtotalenergy},

\begin{equation}
  \delta W_{int}=\gint{0}{v}{\pbrac{\vect{\delta \epsilon} : \vect{\sigma}}}v
  \label{eqn:virtualenergy}
\end{equation}

Using \eqnref{eqn:almansidisplacement} for virtual strain,

\begin{equation}
  \vect{\delta e}=\delby{\vect{\delta u}}{\vect{z}} + \transpose{\delby{\vect{\delta u}}{\vect{z}}} + 
                  \transpose{\delby{\vect{\delta u}}{\vect{z}}}\delby{\vect{\delta u}}{\vect{z}}
  \label{eqn:virtualalmansidisplacement}
\end{equation}

Since virtual displacements are infinitesimally small, quadratic terms in \eqnref{eqn:virtualalmansidisplacement} can be neglected.
The resulting strain tensor, known as small strain tensor \vect{\epsilon}, can be given as,

\begin{equation}
  \vect{\delta \epsilon}=\delby{\vect{\delta u}}{\vect{z}} + \transpose{\delby{\vect{\delta u}}{\vect{z}}} 
  \label{eqn:virtualsmalldisplacement}
\end{equation}
 
Since both $\vect{\sigma}$ and $\vect{\delta \epsilon}$ are symmetric, new vectors are defined by inserting tensor components as follows,

\begin{equation}
  \vect{\delta \epsilon}=\transpose{\sqbrac{\delta \epsilon_{11} \hspace{4 pt} \delta \epsilon_{22} \hspace{4 pt} \delta \epsilon_{33} 
                         \hspace{4 pt} 2\delta \epsilon_{12} \hspace{4 pt} 2\delta \epsilon_{23} \hspace{4 pt} 2\delta \epsilon_{13}}} :
	       	         \vect{\sigma}=\transpose{\sqbrac{\delta \sigma_{11} \hspace{4 pt} \delta \sigma_{22} \hspace{4 pt} \delta \sigma_{33} 
		         \hspace{4 pt} 2\delta \sigma_{12} \hspace{4 pt} 2\delta \sigma_{23} \hspace{4 pt} 2\delta \sigma_{13} }}	  		  
  \label{eqn:newvectors}
\end{equation} 

Substituting \eqnref{eqn:newvectors} into \eqnref{eqn:virtualenergy},

\begin{equation}
  \delta W_{int}=\gint{0}{v}{\pbrac{\transpose{\vect{\delta \epsilon}} \vect{\sigma}}}v
  \label{eqn:virtualenergy1}
\end{equation}

The strain vector $\vect{\delta \epsilon}$ can be related to displacement vector using the following equation,

\begin{equation}
  \vect{\delta \epsilon}=\matr{D} \vect{\delta u} 
  \label{eqn:virtualsmalldisplacement1}
\end{equation}

\noindent where $\matr{D}$ and $\vect{u}$ are linear differential operator and displacement vector respectively and given by,

\begin{equation}
  \begin{array}{c} \matr{D} \end{array} =
  \pbrac{ \begin{array}{ccc} \delby{}{z_{1}} & 0 & 0 \\ 
                             0 & \delby{}{z_{2}} & 0 \\
			     0 & 0 & \delby{}{z_{3}} \\
			     \delby{}{z_{2}} & \delby{}{z_{1}} & 0 \\ 
			     0 & \delby{}{z_{3}} & \delby{}{z_{2}} \\ 
			     \delby{}{z_{3}} & 0 & \delby{}{z_{1}} \\ \end{array} }
  \label{eqn:differentialoperator}
\end{equation}

\begin{equation}
  \vect{\delta u}=\transpose{\pbrac{\delta u_{1} \hspace{4 pt} \delta u_{2} \hspace{4 pt} \delta u_{3}}}
  \label{eqn:displacementvector}
\end{equation}

The virtual displacement is a finite element field and hence the value at any point can be obtained by interpolating nodal 
virtual displacements.

\begin{equation}
  \vect{\delta u}=\matr{\Phi}\matr{\Delta}
  \label{eqn:interpolation}
\end{equation}



\section{Fluid Mechanics Class}

\subsection{Stokes Equation}

\subsection{Darcy's Equation}

\subsection{Navier-Stokes Equation}

\subsubsection{Pressure Poisson Equation}

The Navier-Stokes equation can be written as
\begin{equation}
  \rho\pbrac{\delby{\vect{u}}{t}-\dotprod{\vect{u}}{\gradient{\vect{u}}}}=-\grad{p}+\mu\diverg{\gradient{\vect{u}}}
  \label{eqn:NavierStokes}
\end{equation}

Rearranging for $\grad{p}$ gives
\begin{equation}
  \grad{p}=\mu\diverg{\gradient{\vect{u}}}-\rho\pbrac{\delby{\vect{u}}{t}-\dotprod{\vect{u}}{\gradient{\vect{u}}}}  
\end{equation}
or
\begin{equation}
  \gradient{p}=\vect{b}
  \label{eqn:NavierStokesPressureForm}
\end{equation}
where
\begin{equation}
  \vect{b}=\mu\diverg{\gradient{\vect{u}}}-\rho\pbrac{\delby{\vect{u}}{t}-\dotprod{\vect{u}}{\gradient{\vect{u}}}}
\end{equation}

Note that from \eqnref{eqn:NavierStokesPressureForm} we can write
\begin{equation} 
  \dotprod{\gradient{p}}{\normal}=\dotprod{\vect{b}}{\normal}
  \label{eqn:NavierStokesPressureFormNormal}
\end{equation}

Taking the divergence of both sides of \eqnref{eqn:NavierStokesPressureForm} gives
\begin{equation}
  \diverg{\gradient{p}}=\diverg{\vect{b}}
  \label{eqn:PressurePoisson}
\end{equation}

The corresponding weak form of \eqnref{eqn:PressurePoisson} is
\begin{equation}
  \gint{\Omega}{}{\diverg{\gradient{p}}w}{\Omega}=\gint{\Omega}{}{\diverg{\vect{b}}w}{\Omega}
  \label{eqn:PressurePoissonWeakForm}
\end{equation}

Now the divergence theorm states that
\begin{equation}
  \gint{\Omega}{}{\diverg{\tensor{F}}}{\Omega}=\gint{\Gamma}{}{\dotprod{\tensor{F}}{\normal}}{\Gamma}
  \label{eqn:DivergenceTheorm}
\end{equation}

Applying the divergence theorm where $\tensor{F}=g\vect{f}$ gives
\begin{equation}
  \gint{\Omega}{}{\pbrac{\dotprod{\vect{f}}{\gradient{g}}+g\diverg{\vect{f}}}}{\Omega}=\gint{\Gamma}{}{g\dotprod{\vect{f}}{\normal}}{\Gamma}
  \label{eqn:DivergenceTheormScalarVector}
\end{equation}

Note that when $\vect{f}=\gradient{f}$ is used in
\eqnref{eqn:DivergenceTheormScalarVector} you get Green's identity \ie
\begin{equation}
  \gint{\Omega}{}{\pbrac{\dotprod{\gradient{f}}{\gradient{g}}+g\diverg{\gradient{f}}}}{\Omega}=\gint{\Gamma}{}{g\dotprod{\gradient{f}}{\normal}}{\Gamma}
  \label{eqn:GreensIdentity1}
\end{equation}

Now if we apply \eqnref{eqn:GreensIdentity1} to the left hand side of
\eqnref{eqn:PressurePoissonWeakForm} we get
\begin{equation}
  \gint{\Omega}{}{\diverg{\gradient{p}}w}{\Omega}=\gint{\Gamma}{}{\dotprod{\gradient{p}}{\normal}w}{\Gamma}-
  \gint{\Omega}{}{\dotprod{\gradient{p}}{\gradient{w}}}{\Omega}
\end{equation}
or from \eqnref{eqn:NavierStokesPressureFormNormal}
\begin{equation}
  \gint{\Omega}{}{\diverg{\gradient{p}}w}{\Omega}=\gint{\Gamma}{}{\dotprod{\vect{b}}{\normal}w}{\Gamma}-
  \gint{\Omega}{}{\dotprod{\gradient{p}}{\gradient{w}}}{\Omega}
  \label{eqn:PressurePoissonWeakFormLHS}
\end{equation}

Now if we apply \eqnref{eqn:DivergenceTheormScalarVector} to the right hand
side of \eqnref{eqn:PressurePoissonWeakForm} we get
\begin{equation}
  \gint{\Omega}{}{\diverg{\vect{b}}w}{\Omega}=\gint{\Gamma}{}{\dotprod{\vect{b}}{\normal}w}{\Gamma}-
  \gint{\Omega}{}{\dotprod{\vect{b}}{\gradient{w}}}{\Omega}
  \label{eqn:PressurePoissonWeakFormRHS}
\end{equation}

Substituting \eqnref{eqn:PressurePoissonWeakFormLHS} and
\eqnref{eqn:PressurePoissonWeakFormRHS} into
\eqnref{eqn:PressurePoissonWeakForm} gives
\begin{equation}
  \gint{\Gamma}{}{\dotprod{\vect{b}}{\normal}w}{\Gamma}-
  \gint{\Omega}{}{\dotprod{\gradient{p}}{\gradient{w}}}{\Omega}=\gint{\Gamma}{}{\dotprod{\vect{b}}{\normal}w}{\Gamma}-
  \gint{\Omega}{}{\dotprod{\vect{b}}{\gradient{w}}}{\Omega}
\end{equation} 
or
\begin{equation}
  \gint{\Omega}{}{\dotprod{\gradient{p}}{\gradient{w}}}{\Omega}=\gint{\Omega}{}{\dotprod{\vect{b}}{\gradient{w}}}{\Omega}
  \label{eqn:PressurePoissonFinalWeakForm}
\end{equation}

Now, using a standard Galerkin Finite Element approach
\eqnref{eqn:PressurePoissonFinalWeakForm} can be written in the following form
 \begin{equation}
   \matr{K}_{p}\vect{p}=\vect{s}
  \label{eqn:PressurePoissonFinalWeakForm}
\end{equation}
where $\matr{K}_{p}$ is the pressure stiffness matrix, $\vect{p}$ the vector of unknown
pressure DOFs and $\vect{s}$ the source vector. 

Note that you can write
$\vect{s}$ in terms of $\matr{K}_{u}$ the velocity
stiffness matrix, $\matr{M}$ the mass matrix, $\vect{u}$ the vector of know
velocity DOFs and $\fnof{\vect{h}}{\vect{u}}$ the nonlinear Navier-Stokes
vector.

Note that $\matr{K}_{P}$ is most likely signular and therefore you will need to
set a reference pressure Dirichlet condition somewhere and measure the
pressures relative to this boundary condition value.

Note that this formulation removes all the nasty Neumann conditions in favour
of a Dirichlet condition. It also removes the surface integrals in favour of
volume integrals!

\newpage
\section{Electromechanics Class}

\subsection{Electrostatic Equations}

\subsection{Magnetostatic Equations}

\subsection{Maxwell's Equations}

\section{Classical Field Class}

\subsection{Generalised Laplace's Equation}

The generalised Laplace's equation on a domain, $\Omega$, can be stated as
\begin{equation}
  \diverg{\pbrac{\tensor{\sigma}\grad\phi}}=0
  \label{eqn:Laplacesequation}
\end{equation}
where $\phi$ is the potential throughout the domain and $\tensor{\sigma}$ is
the conductivity tensor throughout the domain. Note that 
$\tensor{\sigma}=\tensor{I}$ gives the standard form of Laplace's equation \ie $\laplacian{\phi}=0$

The corresponding weak form of the equation \eqnref{eqn:Laplacesequation} is
\begin{equation}
  \gint{\Omega}{}{\diverg{\pbrac{\tensor{\sigma}\grad\phi}}w}{\Omega}=0
  \label{eqn:Laplaceweakform}
\end{equation}

Applying Green's theorm to \eqnref{eqn:Laplaceweakform} gives
\begin{equation}
  \gint{\Omega}{}{\diverg{\pbrac{\tensor{\sigma}\grad\phi}}w}{\Omega}= 
  \gint{\Omega}{}{\dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\grad w}}{\Omega}-
  \gint{\Gamma}{}{\dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\vect{n}}w}{\Gamma}
  =0
\end{equation}
or
\begin{equation}
  \gint{\Omega}{}{\dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\grad w}}{\Omega}=
  \gint{\Gamma}{}{\dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\vect{n}w}}{\Gamma}
  \label{eqn:Laplaceweightedresidualform}
\end{equation}

If we now consider the integrand of the left hand side of
\eqnref{eqn:Laplaceweightedresidualform} in tensorial form with covariant
derivatives then
\begin{equation}
  \tensor{\sigma}\grad\phi = \sigma^{i}_{j}\covarderiv{\phi}{i}
\end{equation}
and
\begin{equation}
  \grad w = \covarderiv{w}{i}
\end{equation}

Now, both the above equations represent vectors that are covariant and therefore we must convert the
first equation to a contravariant vector by multiplying by the contravariant
metric tensor so that we can take the dot product. The final tensorial form is
\begin{equation}
  \dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\grad w} = G^{jk}\sigma^{i}_{j}\covarderiv{\phi}{i}\covarderiv{w}{k}
\end{equation}
and thus \eqnref{eqn:Laplaceweightedresidualform} becomes
\begin{equation}
  \gint{\Omega}{}{G^{jk}\sigma^{i}_{j}\covarderiv{\phi}{i}\covarderiv{w}{k}}{\Omega}=
  \gint{\Gamma}{}{\dotprod{\pbrac{\tensor{\sigma}\grad\phi}}{\vect{n}w}}{\Gamma}
  \label{eqn:Laplaceweightedresidualtensorform}
\end{equation}

We can now discretise the domain into finite elements \ie $\Omega=
\displaystyle{\bigcup_{e=1}^{E}}\Omega_{e}$, the left hand side of
\eqnref{eqn:Laplaceweightedresidualtensorform} becomes
\begin{equation}
  \dsum_{e=1}^{E}\gint{\Omega_{e}}{}{G^{jk}\sigma^{i}_{j}\covarderiv{\phi}{i}\covarderiv{w}{k}}{\Omega}
\end{equation}

Now as we only know $\tensor{\sigma}^{*}$, the conductivity in the
$\vect{\nu}$ (fibre) coordinate system rather than $\tensor{\sigma}$, the
conductivity in the $\vect{x}$ (geometric) coordinate system we must transform the mixed
tensor ${\sigma^{*}}^{a}_{b}$ from $\vect{\nu}$ to $\vect{x}$
\begin{equation}
  \sigma^{i}_{j}=\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}
\end{equation}

The left hand side of \eqnref{eqn:Laplaceweightedresidualtensorform} becomes
\begin{equation}
  \dsum_{e=1}^{E}\gint{\Omega_{e}}{}{G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}\covarderiv{\phi}{i}\covarderiv{w}{k}}{\Omega}
\end{equation}

The next step is to approximate the dependent variable, $\phi$, using basis
functions. To simplify this for different types of basis functions an
\emph{interpolation notation} is adopted. This
interpolation is such that $\gbfn{\alpha}{u}{\vect{\xi}}$ are the appropriate
basis functions for the type of element (\eg \bicubicherm, Hermite-sector,
\etc) and dimension of the problem (one, two or \threedal). For example if
$\vect{\xi}=\bbrac{\xi}$ and the element is a cubic Hermite element then
$\gbfn{\alpha}{u}{\vect{\xi}}$ are the cubic Hermite basis functions where
$\alpha$ ranges from $1$ to $2$ and $u$ ranges from $0$ to $1$. If, however,
$\vect{\xi}=\bbrac{\xione,\xitwo}$ and the element is a \bicubicherm element
then $\alpha$ ranges from $1$ to $4$, $u$ ranges from $0$ to $3$ and
$\gbfn{\alpha}{u}{\vect{\xi}}$ is the appropriate basis function for the nodal
variable $\nodedof{\phi}{\alpha}{u}$. The nodal variables are defined as
follows: $\nodedof{\phi}{\alpha}{0}=\nodept{\phi}{\alpha}$,
$\nodedof{\phi}{\alpha}{1}=\delby{\nodept{\phi}{\alpha}}{s_{1}}$,
$\nodedof{\phi}{\alpha}{2}=\delby{\nodept{\phi}{\alpha}}{s_{2}}$,
$\nodedof{\phi}{\alpha}{3}=\deltwoby{\nodept{\phi}{\alpha}}{s_{1}}{s_{2}}$,
\etc Hence for the \bicubicherm element the interpolation function
$\gbfn{2}{3}{\vect{\xi}}$ multiplies the nodal variable
$\phi^{2}_{,3}=\deltwoby{\phi^{2}}{s_{1}}{s_{2}}$ and thus the
interpolation function is $\chbfn{2}{1}{\xione}\chbfn{1}{1}{\xitwo}$.  The
scale factors for the Hermite interpolation are handled by the introduction of
an interpolation scale factor $\gsf{\alpha}{u}$ defined as follows:
$\gsf{\alpha}{0}=1$, $\gsf{\alpha}{1}=\nsftwo{\alpha}{1}$, $\gsf{\alpha}{2}=
\nsftwo{\alpha}{2}$, $\gsf{\alpha}{3}=\nsftwo{\alpha}{1}\nsftwo{\alpha}{2}$,
\etc For Lagrangian basis functions the interpolation scale factors are all
one. The general form of the interpolation notation for $\phi$ is then
\begin{equation}
  \fnof{\phi}{\vect{\xi}}=\gbfn{\alpha}{u}{\vect{\xi}}\nodedof{\phi}
  {\alpha}{u}\gsf{(\alpha)}{(u)}
  \label{eqn:phiinterpolation}
\end{equation}

When dealing with integrals a similar interpolation notation is adopted in
that $d\vect{\xi}$ is the appropriate infinitesimal for the dimension of the
problem. The limits of the integral are also written in bold font and indicate
the appropriate number of integrals for the dimension of the problem.  For
example if $\vect{\xi}=\bbrac{\xione,\xitwo}$ then
$\gint{\vect{0}}{\vect{1}}{x}
{\vect{\xi}}=\giint{0}{1}{0}{1}{x}{\xione}{\xitwo}$, but if $\vect{\xi}=
\bbrac{\xione,\xitwo,\xithree}$ then $\gint{\vect{0}}{\vect{1}}{x}
{\vect{\xi}}=\dintl{0}{1}\!\dintl{0}{1}\!\dintl{0}{1}\,x\,d\xione d\xitwo
d\xithree$.

In order to adopt the interpolation notation above we need to transform from
$\vect{x}$ to $\vect{\xi}$ coordinates. To do this we note that the
contravarient tensor
$G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}$ in
$\vect{x}$ space becomes
$\delby{\xi^{r}}{x^{i}}\delby{\xi^{s}}{x^{k}}G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}$
in $\vect{\xi}$ space. Similarily using the covariant vector transformation
rule we have
\begin{equation}
  \covarderiv{\phi}{r}=\delby{\phi}{\xi^{r}}=\delby{x_{i}}{\xi^{r}}\covarderiv{\phi}{i}\quad\therefore\quad\covarderiv{\phi}{i}=\delby{\xi^{r}}{x_{i}}\delby{\phi}{\xi^{r}}
\end{equation}
and
\begin{equation}
  \covarderiv{w}{s}=\delby{w}{\xi^{s}}=\delby{x_{k}}{\xi^{s}}\covarderiv{w}{k}\quad\therefore\quad\covarderiv{w}{k}=\delby{\xi^{s}}{x_{k}}\delby{w}{\xi^{s}}
\end{equation}

Now, using an interpolated dependent variable and a Galerkin finite element
approach (where the weighting functions are chosen to be the interpolating
basis functions \ie $w=\gbfn{\beta}{v}{\vect{\xi}}$) yields
\begin{equation}
  \dsum_{e=1}^{E}\gint{\vect{0}}{\vect{1}}{\delby{\xi^{r}}{x^{i}}\delby{\xi^{s}}{x^{k}}G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}
    \delby{\xi^{r}}{x_{i}}\delby{\pbrac{\gbfn{\alpha}{u}{\vect{\xi}}\nodedof{\phi}{\alpha}{u}\gsf{(\alpha)}{(u)}}}{\xi^{r}}
    \delby{\xi^{s}}{x_{k}}\delby{\gbfn{\beta}{v}{\vect{\xi}}}{\xi^{s}}
    \abs{\fnof{\matr{J}}{\vect{\xi}}}}{\vect{\xi}}
\end{equation}
where $\fnof{\matr{J}}{\vect{\xi}}$ is the \emph{Jacobian} of the
transformation from the integration $\vect{x}$ to $\vect{\xi}$ coordinates.

Taking the fixed nodal degrees-of-freedom and scale factors outside the integral we have
\begin{equation}
  \dsum_{e=1}^{E}\nodedof{\phi}{\alpha}{u}\gsf{(\alpha)}{(u)}
  \gint{\vect{0}}{\vect{1}}{\delby{\xi^{r}}{x^{i}}\delby{\xi^{s}}{x^{k}}G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}
    \delby{\xi^{r}}{x_{i}}\delby{\gbfn{\alpha}{u}{\vect{\xi}}}{\xi^{r}}
    \delby{\xi^{s}}{x_{k}}\delby{\gbfn{\beta}{v}{\vect{\xi}}}{\xi^{s}}
    \abs{\fnof{\matr{J}}{\vect{\xi}}}}{\vect{\xi}}
  \label{eqn:elementalfemlhs1}
\end{equation}
or
\begin{equation}
  \dsum_{e=1}^{E}\nodedof{\phi}{\alpha}{u}\gsf{(\alpha)}{(u)}
  \gint{\vect{0}}{\vect{1}}{\delby{\gbfn{\alpha}{u}{\vect{\xi}}}{\xi^{r}}\delby{\gbfn{\beta}{v}{\vect{\xi}}}{\xi^{s}}\gamma^{rs}
    \abs{\fnof{\matr{J}}{\vect{\xi}}}}{\vect{\xi}}
  \label{eqn:elementalfemlhs2}
\end{equation}
where
\begin{equation}
  \gamma^{rs}=\delby{\xi^{r}}{x^{i}}\delby{\xi^{s}}{x^{k}}G^{jk}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}\delby{\xi^{r}}{x_{i}}\delby{\xi^{s}}{x_{k}}
\end{equation}

If $G^{jk}=\kronecker{j}{k}$ then $j=k$ and we have
\begin{equation}
  \gamma^{rs}=\delby{\xi^{r}}{x^{i}}\delby{\xi^{s}}{x^{j}}\delby{x_{i}}{\nu_{a}}\delby{\nu^{b}}{x_{j}}{\sigma^{*}}^{a}_{b}\delby{\xi^{r}}{x_{i}}\delby{\xi^{s}}{x_{j}}
\end{equation}



The \emph{contravariant metric tensor} from $\vect{x}$ to $\vect{\xi}$ coordinates defined by
\begin{equation}
  g^{rs}=\delby{\xi^{r}}{x_{i}}\delby{\xi^{s}}{x_{i}}
  \label{eqn:contrametrictensor}
\end{equation}


\subsection{Poisson's Equation}

\subsection{Helmholtz Equation}

\subsection{Wave Equation}

\subsection{Diffusion Equation}

\subsection{Advection-Diffusion Equation}

\subsection{Reaction-Diffusion Equation}

\subsection{Biharmonic Equation}

\section{Bioelectrics Class}

\subsection{Monodomain Equation}

\subsection{Bidomain Equation}

The bidomain model can be thought of as two co-existant intra and extrcelluar
spaces. The potential in the intracellular space is denoted as
$\phi_{i}$ and the potential in the extracellular space is denoted as
$\phi_{e}$. The intra and extracellular potentials are related through the
transmembrane voltage, $V_{m}$, i.e.,

\begin{equation}
  V_{m}=\phi_{i}-\phi_{e}
  \label{eqn:transmembranevoltage}
\end{equation} 

The bidomain equations are

\begin{align}
  A_{m}C_{m}\delby{V_{m}}{t}-\diverg{\pbrac{\tensor{\sigma}_{i}\grad{V_{m}}}}&=\diverg{\pbrac{\tensor{\sigma}_{i}\grad{\phi_{e}}}}-A_{m}\pbrac{I_{ion}-I_{m}}+i_{i} \label{eqn:biodomain1}
  \\
  \diverg{\pbrac{\pbrac{\tensor{\sigma}_{e}+\tensor{\sigma}_{i}}\grad{\phi_{e}}}}&=-\diverg{\pbrac{\tensor{\sigma}_{i}\grad{V_{m}}}}-i_{i}+i_{e}
  \label{eqn:bidomain2}
\end{align}

where $A_{m}$ is the surface to volume ratio for the cell, $C_{m}$ is
the specific membrance capacitance, $\tensor{\sigma}_{i}$ is the intracellular
conductivity tensor, $\tensor{\sigma}_{e}$ is the extracellular
conductivity tensor, $I_{ion}$ is the ionic current, $I_{m}$ is the
transmembrane current

\subsubsection{Operator splitting}

Consider the initial value problem
\begin{align}
  \dby{u}{t}&=\pbrac{L_{1}+L_{2}}u \\
  \fnof{u}{0}&=u_{0}
\end{align}
where $L_{1}$ and $L_{2}$ are some operators.

For Gudunov splitting we first solve
\begin{align}
  \dby{v}{t}&=L_{1}v \\
  \fnof{v}{0}&=u_{0}
\end{align}
for $t\in\sqbrac{0,\Delta t}$ to give $\fnof{v}{\Delta t}$. Next we solve
\begin{align}
  \dby{w}{t}&=L_{2}w \\
  \fnof{w}{0}&=\fnof{v}{\Delta t}
\end{align}
for $t\in\sqbrac{0,\Delta t}$ to give $\fnof{w}{\Delta t}$. We now set
\begin{equation}
\fnof{\tilde{u}}{\Delta t}=\fnof{w}{\Delta t}
\end{equation}
where $\tilde{u}$ is a approximate solution to the orginal initial value
problem.

For Strang splitting we first solve
\begin{align}
  \dby{v}{t}&=L_{1}v \\
  \fnof{v}{0}&=u_{0}
\end{align}
for $t\in\sqbrac{0,\frac{\Delta t}{2}}$ to give $\fnof{v}{\frac{\Delta t}{2}}$. Next we solve
\begin{align}
  \dby{w}{t}&=L_{2}w \\
  \fnof{w}{0}&=\fnof{v}{\frac{\Delta t}{2}}
\end{align}
for $t\in\sqbrac{0,\Delta t}$ to give $\fnof{w}{\Delta t}$. Next we solve
\begin{align}
  \dby{v}{t}&=L_{1}v \\
  \fnof{v}{\frac{\Delta t}{2}}&=\fnof{w}{\Delta t}
\end{align}
for $t\in\sqbrac{\frac{\Delta t}{2},\Delta t}$ to give $\fnof{v}{\Delta t}$.We now set
\begin{equation}
\fnof{\tilde{u}}{\Delta t}=\fnof{v}{\Delta t}
\end{equation}
where $\tilde{u}$ is a approximate solution to the orginal initial value
problem.

\section{Modal Class}

\section{Fitting Class}

\section{Optimisation Class}
