<chapter>
  <title>OpenCMISS Concepts</title>
  <para>openCMISS has the following top level objects.</para>
  <itemizedlist>
    <listitem>Basis functions</listitem>
    <listitem>Coordinate systems</listitem>
    <listitem>Nodes</listitem>
    <listitem>Regions</listitem>
    <listitem>Problems</listitem>
    <listitem>Computational environments</listitem>
    <listitem>Base system(Diagnostics, I?O etc.)</listitem>
  </itemizedlist>
  <mediaobject>
    <imageobject role="xhtml">
      <imagedata fileref="../images/openCMISS_topStructure.JPG" format="JPG" scale="90" scalefit="1"/>
    </imageobject>
    <imageobject role="fo">
      <imagedata fileref="../images/openCMISS_topStructure.JPG" format="JPG" scale="50" scalefit="1"/>
    </imageobject>
  </mediaobject>
  <section id='basis'>
    <title>Basis Functions</title>
    <para>
      Basis functions are the key item to specify the field approximation/interpolation and the linking of nodes and elements to form a mesh.
      Currently, it has two types: Lagrange-Hermite tensor product and Simplex.
      Lagrange-Hermite tensor product can be further divided into linear to cubic lagrange, cubic and quadratic hermite. 
      It can be arbitrarily collapsed (two or more nodes in the same location) in any one direction or in any two directions to give a degenerate basis.
      Simplex basic functions could contain line, triangular and tetrahedral elements. 
      It could be linear, quadratic or cubic.
      Arbitrary Gaussian quadrature can integrate from 1st to 5th order (3rd  order for lines at the moment).
      Can only have the same order in each direction at the moment.
      Specifying a basis function automatically generates all necessary line and face basis functions as sub-bases of the basis function.
    </para>
    <para>Basis function has the following attributes:</para>
    <itemizedlist>
      <listitem>User number</listitem>
      <listitem>Global number</listitem>
      <listitem>Family number</listitem>
      <listitem>Finished tag</listitem>
      <listitem>Type</listitem>
      <listitem>Is Hermite</listitem>
      <listitem>Number of XI</listitem>
      <listitem>Number of XI coordinates</listitem>
      <listitem>...</listitem>
    </itemizedlist>
  </section>
  <section id='coordinate system'>
    <title>Coordinate Systems</title>
    <para>
      Coordinate system is a system for assigning an n-tuple of numbers or scalars to each point in an n-dimensional space. 
      It anchors the regions within the real world. 
      Coordinate system can have different types such as:
    </para>
    <itemizedlist>
      <listitem>Rectangular cartesian</listitem>
      <listitem>Cylindrical polar</listitem>
      <listitem>Spherical polar</listitem>
      <listitem>Prolate spheroidal</listitem>
      <listitem>Oblate spheroidal</listitem>
    </itemizedlist>
    <para>
      There is a global (world) coordinate system aligned with 3D rectangular cartesian space.
    </para>
    <para>Coordinate system has the following attributes:</para>
    <itemizedlist>
      <listitem>User number</listitem>
      <listitem>Finished tag</listitem>
      <listitem>Type</listitem>
      <listitem>Number of dimensions</listitem>
      <listitem>Focus (for prolate-spheriodal system only)</listitem>
      <listitem>Origins</listitem>
      <listitem>Orientation</listitem>
    </itemizedlist>
  </section>
  <section id='regions'>
    <title>Regions</title>
    <para>
      Regions are one of the primary objects in openCMISS. 
      Regions are hierarchical in nature in that a region can have one parent region and a number of daughter sub-regions. 
      Daughter regions are related in space to parent regions by an origin and an orientation of the regions coordinate system.
      Daughter regions may only have the same or fewer dimensions as the parent region.
      There is a global (world) region (number 0) that has the global (world) coordinate system.
    </para>
    <mediaobject>
      <imageobject role="xhtml">
        <imagedata fileref="../images/region_definition.JPG" format="JPG" scale="90"/>
      </imageobject>
      <imageobject role="fo">
        <imagedata fileref="../images/region_definition.JPG" format="JPG" scale="50"/>
      </imageobject>
    </mediaobject>
    <para>Region has the following attributes</para>
    <itemizedlist>
      <listitem>User number</listitem>
      <listitem>Finished tag</listitem>
      <listitem>Label</listitem>
      <listitem>Number of sub(daughter) regions</listitem>
      <listitem>Coordinate system pointer</listitem>
      <listitem>Nodes</listitem>
      <listitem>Meshes</listitem>
      <listitem>Fields</listitem>
      <listitem>Equations</listitem>
      <listitem>Parent region pointer</listitem>
      <listitem>Daughter regions pointers</listitem>
    </itemizedlist>
    <mediaobject>
      <imageobject role="xhtml">
        <imagedata fileref="../images/region_structure.JPG" format="JPG" scale="90"/>
      </imageobject>
      <imageobject role="fo">
        <imagedata fileref="../images/region_structure.JPG" format="JPG" scale="50"/>
      </imageobject>
    </mediaobject>
    <section id='nodes'>
      <title>Nodes</title>
      <para>
        There are three places storing nodal information. 
        Nodes associated with region defines the nodes identification and the nodes geometric (initial) position. 
      </para>
      <para>Node has the following attributes</para>
      <itemizedlist>
        <listitem>User number</listitem>
        <listitem>Global number</listitem>
        <listitem>Label</listitem>
        <listitem>Initial Position</listitem>
      </itemizedlist>
    </section>
    <section id='mesh'>
      <title>Meshes</title>
      <para>
        Meshes are topological constructs within a region which fields use to define themselves.
        Meshes are made up of a number of mesh components.
        All mesh components in a mesh must “conform”, that is have the same number of elements, Xi directions etc. 
      </para>
      <para>Mesh has the following attributes:</para>
      <itemizedlist>
        <listitem>User number</listitem>
        <listitem>Global number</listitem>
        <listitem>Finished tag</listitem>
        <listitem>Region pointer</listitem>
        <listitem>Number of dimensions</listitem>
        <listitem>Number of components</listitem>
        <listitem>Embedded flag</listitem>
        <listitem>Embedding mesh pointer</listitem>
        <listitem>Embedded meshes pointers</listitem>
        <listitem>Number of elements</listitem>
        <listitem>Number of faces</listitem>
        <listitem>Number of lines</listitem>
        <listitem>Mesh topology pointers</listitem>
        <listitem>Decomposition pointers</listitem>
      </itemizedlist>
      <mediaobject>
        <imageobject role="xhtml">
          <imagedata fileref="../images/mesh_structure.JPG" format="JPG" scale="90"/>
        </imageobject>
        <imageobject role="fo">
          <imagedata fileref="../images/mesh_structure.JPG" format="JPG" scale="50"/>
        </imageobject>
      </mediaobject>
      <section id='mesh_topology'>
        <title>Mesh Topology</title>
        <para>
          Mesh components (Topology) are made up from nodes, elements and basis functions.
          A new mesh component is required for each different form of interpolation e.g., one mesh component is bilinear Lagrange and another is biquadratic Lagrange.
        </para>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/meshTopology_definition.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/meshTopology_definition.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <para>Mesh topology has the following attributes:</para>
        <itemizedlist>
          <listitem>Mesh component number</listitem>
          <listitem>Mesh pointer</listitem>
          <listitem>Nodes pointers</listitem>
          <listitem>Element pointers</listitem>
          <listitem>DOFs pointers</listitem>
        </itemizedlist>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/meshTopology_structure.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/meshTopology_structure.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
      </section>
      <section id='decomposition'>
        <title>Decompositions</title>
        <para>
          Mesh decomposition (partitioning) is used to split a computationally expensive mesh into smaller subdomains (parts) for parallel computing. 
        </para>
        <para>Decomposition has the following attributes</para>
        <itemizedlist>
          <listitem>User number</listitem>
          <listitem>Global number</listitem>
          <listitem>Finished tag</listitem>
          <listitem>Mesh pointer</listitem>
          <listitem>Mesh component number</listitem>
          <listitem>Decomposition type</listitem>
          <listitem>Number of domains</listitem>
          <listitem>Number of edge cut</listitem>
          <listitem>Element domain numbers</listitem>
          <listitem>Decomposition topology pointer</listitem>
          <listitem>Domains pointers(list of domain which has the same size as the number of components in the mesh)</listitem>
        </itemizedlist>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/meshDecomposition_structure.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/meshDecomposition_structure.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <section id='domain'>
          <title>Domain</title>
          <para>Each domain stores domain information for relevant mesh component.</para>
          <para>The domain object contains the following attributes:</para>
          <itemizedlist>
            <listitem>Decomposition pointer</listitem>
            <listitem>Mesh pointer</listitem>
            <listitem>Mesh component number</listitem>
            <listitem>Region pointer</listitem>
            <listitem>Number of dimensions</listitem>
            <listitem>Node domain(The domain number that the np'th global node is in for the domain decomposition. Note: the domain numbers start at 0 and go up to the NUMBER_OF_DOMAINS-1)</listitem>
            <listitem>Domain mappings(for each mapped object e.g. nodes, elements, etc)</listitem>
            <listitem>Domain topology pointer(elements, nodes, DOFs)</listitem>
          </itemizedlist>
          <mediaobject>
            <imageobject role="xhtml">
              <imagedata fileref="../images/meshDecompositionDomain_structure.JPG" format="JPG" scale="90"/>
            </imageobject>
            <imageobject role="fo">
              <imagedata fileref="../images/meshDecompositionDomain_structure.JPG" format="JPG" scale="50"/>
            </imageobject>
          </mediaobject>
          <section id='domain_mapping'>
            <title>Domain Mappings</title>
            <para>Stores information for each mapped object e.g. nodes, elements, etc.</para>
            <para>The domain mapping contains the following attributes:</para>
            <itemizedlist>
              <listitem>Number of local</listitem>
              <listitem>Total number of local</listitem>
              <listitem>Numbers of domain local</listitem>
              <listitem>Number of global</listitem>
              <listitem>Number of domains</listitem>
              <listitem>Number of internal</listitem>
              <listitem>Internal list</listitem>
              <listitem>Number of boundary</listitem>
              <listitem>Boundary list</listitem>
              <listitem>Number of ghost</listitem>
              <listitem>Ghost list</listitem>
              <listitem>Local to global map</listitem>
              <listitem>Global to local map</listitem>
              <listitem>Number of adjacent domains</listitem>
              <listitem>Pointer to list of adjacent domains by domain number</listitem>
              <listitem>List of adjacent domains</listitem>
            </itemizedlist>
            <mediaobject>
              <imageobject role="xhtml">
                <imagedata fileref="../images/meshDecompositionDomainMapping_structure.JPG" format="JPG" scale="90"/>
              </imageobject>
              <imageobject role="fo">
                <imagedata fileref="../images/meshDecompositionDomainMapping_structure.JPG" format="JPG" scale="50"/>
              </imageobject>
            </mediaobject>
          </section>
        </section>
      </section>
    </section>
    <section id='field'>
      <title>Fields</title>
      <para>
        Fields are the central object for storing information and framing the problem.
        Fields have a number of field variables i.e., u, ∂u/∂n, ∂u/∂t, ∂2u/∂t2.
        Each field variable has a number of components.
        A field is defined on a decomposed mesh.
        Each field variable component is defined on a decomposed mesh component.
      </para>
      <para>Field can contains the following attributes:</para>
      <itemizedlist>
        <listitem>User number</listitem>
        <listitem>Global number</listitem>
        <listitem>Finished tag</listitem>
        <listitem>Region pointer</listitem>
        <listitem>Type(Geometric, Fibre, General, Material, Source)</listitem>
        <listitem>Dependent type(Independent, Dependent)</listitem>
        <listitem>Dimension</listitem>
        <listitem>Decomposition pointer</listitem>
        <listitem>Number of variables</listitem>
        <listitem>Variables</listitem>
        <listitem>Scalings sets</listitem>
        <listitem>Mappings(DOF->Field parameters)</listitem>
        <listitem>Parameter sets(distributed vectors)</listitem>
        <listitem>Geometric field pointer</listitem>
        <listitem>Geomatric field parameters</listitem>
        <listitem>Create values cache</listitem>
      </itemizedlist>
      <mediaobject>
        <imageobject role="xhtml">
          <imagedata fileref="../images/field_structure.JPG" format="JPG" scale="90"/>
        </imageobject>
        <imageobject role="fo">
          <imagedata fileref="../images/field_structure.JPG" format="JPG" scale="50"/>
        </imageobject>
      </mediaobject>
      <section id='field_variable'>
        <title>Field variable</title>
        <para>
          Field variable stores variables for the field such as dependent variables. 
          For example, in the Laplace's equation(FEM), it stores two variables: u and ∂u/∂n.
          Each field variable has a number of components.  
        </para>
        <para>Field variable has the following attributes:</para>
        <itemizedlist>
          <listitem>Variable number</listitem>
          <listitem>Variable type</listitem>
          <listitem>Field pointer</listitem>
          <listitem>Region pointer</listitem>
          <listitem>Max number of interpolation parameters</listitem>
          <listitem>Number of DOFs</listitem>
          <listitem>Total number of DOFs</listitem>
          <listitem>Global DOF List</listitem>
          <listitem>Domain mapping pointer</listitem>
          <listitem>Number of components</listitem>
          <listitem>Components</listitem>
        </itemizedlist>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/fieldVariable_structure.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/fieldVariable_structure.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <section id='field_variable_component'>
          <title>Field Variable Component</title>
          <para></para>
          <para>Field Variable Component has the following attributes:</para>
          <itemizedlist>
            <listitem>Component number</listitem>
            <listitem>Variable pointer</listitem>
            <listitem>Field pointer</listitem>
            <listitem>Interpolation type</listitem>
            <listitem>Mesh component number</listitem>
            <listitem>Scaling index</listitem>
            <listitem>Domain pointer</listitem>
            <listitem>Max number of interpolation parameters</listitem>
            <listitem>Mappings(Field paramters-&gt;DOF)</listitem>
          </itemizedlist>
        </section>
      </section>
      <section id='parameter_set'>
        <title>Parameter set</title>
        <para>Parameter set stores values for each field variable component.</para>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/field_parameter_set_definition.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/field_parameter_set_definition.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <para>Parameter set has the following Attributes:</para>
        <itemizedlist>
          <listitem>Set index</listitem>
          <listitem>Set type</listitem>
          <listitem>Parameters pointer</listitem>
        </itemizedlist>
      </section>
    </section>
    <section id='equation_set'>
      <title>Equations Sets</title>
      <para>
        Equations sets are aimed to have multiple classes,
        e.g. Elasticity, Fluid mechanics, Electromagnetics, General field problems, Fitting, Optimisation.
        Different equations are within each class, e.g. Bidomain, Navier-stokes etc.
        Each equation can use different solution techniques, e.g. FEM, BEM, FD, GFEM.
        The equation set is associated with a region and is built using the fields defined on the region.
      </para>
      <para>
        The numerical methods are used which will result in a discretised matrix-vector form of the governing equations.
        openCMISS is designed to generate equations sets with a number of "equations" matrices.
      </para>
      <para>e.g, damped mass spring system</para>
      <mml:math>
        <mml:mrow>
          <mml:mi>M&uuml;</mml:mi>
          <mml:mo>+</mml:mo>
          <mml:mi>C&ugrave;</mml:mi>
          <mml:mo>+</mml:mo>
          <mml:mi>Ku</mml:mi>
          <mml:mo>=</mml:mo>
          <mml:mi>f</mml:mi>
        </mml:mrow>
      </mml:math>      
      <para>will be represented as:</para>
      <mediaobject>
        <imageobject role="xhtml">
          <imagedata fileref="../images/fieldEquationsets-matrix.JPG" format="JPG" scale="90"/>
        </imageobject>
        <imageobject role="fo">
          <imagedata fileref="../images/fieldEquationsets-matrix.JPG" format="JPG" scale="50"/>
        </imageobject>
      </mediaobject>
      <para>Equations Set has the following attributes:</para>
      <itemizedlist>
        <listitem>User number</listitem>
        <listitem>Global number</listitem>
        <listitem>Finished tag</listitem>
        <listitem>Region pointer</listitem>
        <listitem>Class identifier</listitem>
        <listitem>Type identifier</listitem>
        <listitem>Sub type identifier</listitem>
        <listitem>Linearity type(?)</listitem>
        <listitem>Time dependence type(?)</listitem>
        <listitem>Solution method</listitem>
        <listitem>Geometry (fibre?) field pointer</listitem>
        <listitem>Materials field pointer</listitem>
        <listitem>Source field pointer</listitem>
        <listitem>Dependent field pointer</listitem>
        <listitem>Analytic info pointer(Analytic info stored in dependent field currently)</listitem>
        <listitem>Fixed conditions</listitem>
        <listitem>Equations pointer</listitem>
      </itemizedlist>
      <mediaobject>
        <imageobject role="xhtml">
          <imagedata fileref="../images/fieldEquationsets-structure.JPG" format="JPG" scale="90"/>
        </imageobject>
        <imageobject role="fo">
          <imagedata fileref="../images/fieldEquationsets-structure.JPG" format="JPG" scale="50"/>
        </imageobject>
      </mediaobject>
      <section id='equations'>
        <title>Equations</title>
        <para>Equation holds the matrices and mapping information.</para>
        <para>
          The Field variable to matrix mappings maps each field variable onto the equations matrices or RHS vector. 
        </para>
        <para>e.g. Laplace(FEM): 2 variables, 1 component</para>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingFEM.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingFEM.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <para>e.g. Laplace(BEM): 2 variables, 1 component</para>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingBEM.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingBEM.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <para>e.g. Heat equation(explicit time/FEM space): 2 variables, 1 component</para>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingHeat.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/fieldEquationsetsEquations-mappingHeat.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
        <para>TODO matrix distribution</para>
        <para>Equations has the following attributes:</para>
        <itemizedlist>
          <listitem>Equation set pointer</listitem>
          <listitem>Finished tag</listitem>
          <listitem>Output type</listitem>
          <listitem>Sparsity type</listitem>
          <listitem>Interpolation pointer</listitem>
          <listitem>Linear equation data pointer</listitem>
          <listitem>Nonlinear equation data pointer</listitem>
          <listitem>Time(non-static) data pointer</listitem>
          <listitem>Equations mapping pointer</listitem>
          <listitem>Equations Matrices</listitem>
        </itemizedlist>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/fieldEquationsetsEquations-structure.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/fieldEquationsetsEquations-structure.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
      </section>
    </section>
  </section>
  <section id='problem'>
    <title>Problems</title>
    <para>
      A problem has a number of solutions (each with their solver) inside a problem control loop. 
      Problem associated with region via solution which maps to equations sets and hence links to region. 
      Multiple problems can be in the same region, or multiple regions can woek to solve one problem. 
    </para>
    <para>Problem has the following attributes:</para>
    <itemizedlist>
      <listitem>User number</listitem>
      <listitem>Global number</listitem>
      <listitem>Finished tag</listitem>
      <listitem>Class</listitem>
      <listitem>Type</listitem>
      <listitem>Subtype</listitem>
      <listitem>Control pointer</listitem>
      <listitem>Number of solutions</listitem>
      <listitem>Soultions pointer</listitem>
    </itemizedlist>
    <mediaobject>
      <imageobject role="xhtml">
        <imagedata fileref="../images/problem_structure.JPG" format="JPG" scale="90"/>
      </imageobject>
      <imageobject role="fo">
        <imagedata fileref="../images/problem_structure.JPG" format="JPG" scale="50"/>
      </imageobject>
    </mediaobject>
    <section>
      <title>Solutions</title>
      <para>Solution has the following attributes:</para>
      <itemizedlist>
        <listitem>Solution number</listitem>
        <listitem>Finished tag</listitem>
        <listitem>Linear solution data pointer</listitem>
        <listitem>Nonlinear solution data pointer</listitem>
        <listitem>Time (non-static) solution data pointer</listitem>
        <listitem>Equations set to add (the next equations set to add)</listitem>
        <listitem>Index of added equations set(the last successfully added equations set)</listitem>
        <listitem>Soultion mapping(which contains equations sets)</listitem>
        <listitem>Solver pointer</listitem>
      </itemizedlist>
      <section>
        <title>Solvers</title>
        <para>Solver has the following attributes:</para>
        <itemizedlist>
          <listitem>Solution pointer</listitem>
          <listitem>Finished tag</listitem>
          <listitem>Solve type</listitem>
          <listitem>Output type</listitem>
          <listitem>Sparsity type</listitem>
          <listitem>Linear solver pointer</listitem>
          <listitem>Non-linear solver pointer</listitem>
          <listitem>Time integrationn solver pointer</listitem>
          <listitem>Eigenproblem solver pointer</listitem>
          <listitem>Solver matrices</listitem>
        </itemizedlist>
        <mediaobject>
          <imageobject role="xhtml">
            <imagedata fileref="../images/problemSolutionSolver_structure.JPG" format="JPG" scale="90"/>
          </imageobject>
          <imageobject role="fo">
            <imagedata fileref="../images/problemSolutionSolver_structure.JPG" format="JPG" scale="50"/>
          </imageobject>
        </mediaobject>
      </section>
    </section>
    <section id='control'>
      <title>Control</title>
      <para>Control has the following attributes:</para>
      <itemizedlist>
        <listitem>Problem pointer</listitem>
        <listitem>Finished tag</listitem>
        <listitem>Control type</listitem>
      </itemizedlist>
    </section>
  </section>
</chapter>