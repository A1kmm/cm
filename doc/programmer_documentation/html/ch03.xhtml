<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 3. Obtaining the Code and Setting up the Development Environment</title><meta content="DocBook XSL Stylesheets V1.68.1" name="generator" /><link rel="start" href="index.xhtml" title="OpenCMISS Programmer Documentation" /><link rel="up" href="index.xhtml" title="OpenCMISS Programmer Documentation" /><link rel="prev" href="ch02.xhtml" title="Chapter 2. OpenCMISS Concepts" /><link rel="next" href="ch04.xhtml" title="Chapter 4. Object Interface" /></head><body><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Chapter 3. Obtaining the Code and Setting up the Development Environment</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch02.xhtml">Prev</a> </td><th align="center" width="60%"> </th><td align="right" width="20%"> <a accesskey="n" href="ch04.xhtml">Next</a></td></tr></table><hr /></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="N10386" />Chapter 3. Obtaining the Code and Setting up the Development Environment</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ch03.xhtml#N10389">1. Obtaining the Code and Libraries</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.xhtml#N10398">1.1. Obtain the Code</a></span></dt><dt><span class="section"><a href="ch03.xhtml#N103AB">1.2. Obtain the Libraries</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.xhtml#N103D1">2. Project Set up</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.xhtml#N103D4">2.1. On AIX 5.3 (HPC)</a></span></dt><dt><span class="section"><a href="ch03.xhtml#N10409">2.2. On Ubuntu 8.04</a></span></dt><dt><span class="section"><a href="ch03.xhtml#N10455">2.3. On Windows XP (Visual Studio 2005)</a></span></dt><dt><span class="section"><a href="ch03.xhtml#N1049D">2.4. On Windows Vista (Visual Studio 2008)</a></span></dt></dl></dd><dt><span class="section"><a href="ch03.xhtml#N104CE">3. Libraries Build (Optional)</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.xhtml#N104D1">3.1. Compiling PETSc</a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h2 class="title" style="clear: both"><a id="N10389" />1. Obtaining the Code and Libraries</h2></div></div></div><p>
      To obtain the openCMISS source you need to check it out from the subversion repository. 
      There are two parts to openCMISS to obtain - openCMISS itself and the various libraries it needs.
    </p><p>In your root openCMISS directory, make the <code class="filename">opencmiss</code> and <code class="filename">opemcmissextra</code> directories.</p><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N10398" />1.1. Obtain the Code</h3></div></div></div><p>The openCMISS repository is at https://opencmiss.svn.sourceforge.net/svnroot/opencmiss/cm</p><p>To check out the main trunk of openCMISS issue the following command in the <code class="filename">opencmiss</code> directory:</p><code class="code">svn co https://opencmiss.svn.sourceforge.net/svnroot/opencmiss/cm/trunk cm</code><p>If you are not familar with subversion, have a look at <a href="http://svnbook.red-bean.com" target="_top">here</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N103AB" />1.2. Obtain the Libraries</h3></div></div></div><p>The openCMISS libraries repository is at http://www.physiome.ox.ac.uk/svn/opencmissextras/cm</p><p>To check out the main trunk of the various libraries required with openCMISS issue the following command in the <code class="filename">opencmissextra</code> directory:</p><code class="code">svn co http://www.physiome.ox.ac.uk/svn/opencmissextras/cm/trunk/external/architecture cm/external/architecture</code></div><p>
      where architecture is the appropriate architecture for the machine. Possible architectures are:
    </p><div class="itemizedlist"><ul type="disc"><li>i386-win32</li><li>i386-win32-debug</li><li>i686-linux</li><li>i686-linux-debug</li><li>x86_64-linux</li><li>x86_64-linux-debug</li><li>rs6000-32-aix</li><li>rs6000-32-aix-debug</li></ul></div><p>
      Currently, the svn repository for openCMISS libraries is down. An alternative location for the libraries is at hpc. 
      Go to <code class="filename">\\bioengsmb\cmiss\opencmissextras\cm</code> and copy the necessary files. 
      The folder structure is the same as svn repository. 
    </p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h2 class="title" style="clear: both"><a id="N103D1" />2. Project Set up</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N103D4" />2.1. On AIX 5.3 (HPC)</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N103D7" />2.1.1. Set environment</h4></div></div></div><p>Set environment variable to point to openCMISS</p><code class="code">setenv OPENCMISS_ROOT=&lt;path to your opencmiss folder&gt;</code><p>Set environment variable to point to openCMISS-extras</p><code class="code">setenv OPENCMISSEXTRAS_ROOT=&lt;path to your opencmissextras folder&gt;</code></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N103E2" />2.1.2. Set MPI</h4></div></div></div><p>Create a file called <code class="filename">hostfile.list</code> in your home directory.</p><p>Inside the file, add several lines of “<span class="quote">hpc.bioeng.auckland.ac.nz</span>”</p><p>In <code class="filename">.rhost</code> file in the home direcotry, add “<span class="quote">hpc &lt;username&gt;</span>”</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N103F7" />2.1.3. Compile</h4></div></div></div><p>Change directory to opencmiss/cm</p><p>Change directory to examples/&lt;example%gt;</p><p>Use <code class="code">gmake</code>.</p><p>This should result in a binary that you can run in the <code class="filename">bin/rs6000-32-aix</code> folder.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N10409" />2.2. On Ubuntu 8.04</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N1040C" />2.2.1. Set environment</h4></div></div></div><p>Set environment variable to point to opencmiss</p><code class="code">setenv OPENCMISS_ROOT=&lt;path to your opencmiss folder&gt;</code><p>Set environment variable to point to opencmiss-extras</p><code class="code">setenv OPENCMISSEXTRAS_ROOT=&lt;path to your opencmissextras folder&gt;</code><p>It is also helpful to add the following</p><code class="code">
          <p>setenv PATH ${OPENCMISSEXTRAS_ROOT}/cm/external/${archname}/bin:${PATH}</p>
          <p>setenv PATH ${OPENCMISS_ROOT}/cm/bin/${archname}:${PATH}</p>
        </code><p>where ${archname} is the appropriate architecture e.g., i686-linux, x86_64-linux.</p><p>If you are using totalview you will also need to add</p><code class="code">setenv LM_LICENSE_FILES &lt;path-to-the-flex-directory&gt;</code></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10427" />2.2.2. Install Compilers</h4></div></div></div><p>Download Intel Fotran Compiler from <a href="http://www.intel.com/cd/software/products/asmo-na/eng/282048.htm" target="_top">here</a>.</p><p>Extract the file and follow the <code class="filename">install.htm</code> to install</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10436" />2.2.3. Install MPI</h4></div></div></div><p>Download MPICH2 from <a href="http://www.mcs.anl.gov/research/projects/mpich2/" target="_top">here.</a></p><p>Extract the file and follow the <code class="filename">README</code> to install.</p><p>Remember to set the path as suggested.</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10446" />2.2.4. Compile</h4></div></div></div><p>To build an example project:</p><code class="code">make</code><p>To run the example project:</p><code class="code">mpd &amp; mpirun -n 2 path/to/the/execution/file</code><p>To debug the project using TotalView:</p><code class="code">mpd &amp; mpirun -tv 2 path/to/the/execution/file</code></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N10455" />2.3. On Windows XP (Visual Studio 2005)</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10458" />2.3.1. Install Compilers</h4></div></div></div><p>Download Intel Fortran Compiler from <a href="http://www.intel.com/cd/software/products/asmo-na/eng/278834.htm" target="_top">here</a>.</p><p>Execute the exe file and follow the installation wizard.</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10463" />2.3.2. Install MPI</h4></div></div></div><p>Download MPICH2 from <a href="http://www.mcs.anl.gov/research/projects/mpich2/" target="_top">here.</a></p><p>You can either download the source archive and follow the <code class="filename">README.windows</code> file to install or download the installer to install.</p><p>Set bin folder to the path</p><p>To start the MPI, run <code class="code">smpd -start</code> in command window.</p><p>NOTE: as from MPICH2 version 1.0.7 the library names have changed. <code class="filename">libmpich2</code> has now become <code class="filename">libmpi</code>!</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10482" />2.3.3. Compile and Debug</h4></div></div></div><p>Build the Fortran project under the debug mode and generate the <code class="filename">opencmisstest-debug.exe</code> file.</p><p>In the C Project (since the Fortran projects do not support MPI cluster debugger), configure the debugging properties according to <a href="http://download.microsoft.com/download/6/8/d/68d7d82b-e477-4699-b403-72be2e6218b1/CCS03DebugParallelAppsVS05.doc" target="_top">this</a>.</p><p>The MPIShim location is in the path similar to C:\Program Files\Microsoft Visual Studio 8\Common7\IDE\Remote Debugger\x86\mpishim.exe.</p><p>Debug the C project.</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N10495" />2.3.4. Run</h4></div></div></div><p>To run the project in the command window:</p><span><strong class="command">mpiexec -n 2 -localroot &lt;path to the execution file&gt;</strong></span></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N1049D" />2.4. On Windows Vista (Visual Studio 2008)</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N104A0" />2.4.1. Install Compilers</h4></div></div></div><p>Download Intel Fortran Compiler from <a href="http://www.intel.com/cd/software/products/asmo-na/eng/278834.htm" target="_top">here</a>.</p><p>Execute the exe file and follow the installation wizard.</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N104AB" />2.4.2. Install MPI</h4></div></div></div><p>Before you install MPICH2 under Vista you must turn off User Account Control</p><div class="orderedlist"><ol type="1"><li>Goto Start -&gt; Control Panel</li><li>Double-click on User Accounts</li><li>Click "Turn User Account Control on or off"</li><li>Untick "Use User Account Control (UAC) to help protect your computer" and click OK</li><li>Restart your computer.</li></ol></div><p>Download from <a href="http://www.mcs.anl.gov/research/projects/mpich2/" target="_top">here</a>. Choose the Win32 IA32 (binary) option.</p><p>Run the downloaded .msi file. Follow all instructions and install "For everybody".</p><p>Once you have installed MPICH2 you can turn User Account Control back on. Follow the instructions above and in 4. tick the "Use User Account Control ...".</p><p>NOTE: as from MPICH2 version 1.0.7 the library names have changed. libmpich2 has now become libmpi!</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N104C9" />2.4.3. Compile</h4></div></div></div><p>For each example, go into the VisualopenCMISS_08 folder. Double click the VisualopenCMISS project solution file to lauch Visual Studio.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h2 class="title" style="clear: both"><a id="N104CE" />3. Libraries Build (Optional)</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h3 class="title"><a id="N104D1" />3.1. Compiling PETSc</h3></div></div></div><p>Note this is assuming you have the Intel Fortran compiler version 10.1.024. Adjust the version string as necessary.</p><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N104D6" />3.1.1. Step1: Linux Environment installation and Compiler Environment Set up</h4></div></div></div><p>Under windows system:</p><div class="itemizedlist"><ul type="disc"><li>Install Cygwin if you need to. Cywin can be found <a href="http://www.cygwin.com/" target="_top">here</a>. Make sure you include the make and python modules when you install.</li><li>Lauch a Command Prompt Window</li><li>Run the ifortvars.bat batch file to setup your Intel Fortran environment. e.g., "C:\Program Files\Intel\Compiler\Fortran\10.1.024\IA32\Bin\ifortvars.bat"</li><li>Run the Cygwin batch file to setup the unix environment e.g., "C:\Cygwin\Cygwin.bat"</li></ul></div><p>For Linux</p><p>TODO</p></div><div class="section" lang="en"><div class="titlepage"><div><p class="returntotop"><a href="ch03.xhtml">Return to top</a></p><div><h4 class="title"><a id="N104EC" />3.1.2. Step2: Compile PETSC</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li>Change to the opencmissextras PETSc directory e.g., if opencmissextras root is E:\opencmissextras and we are compiling PETSC version petsc-2.3.3-p8 then "cd /cygwin/e/opencmissextras/cm/external/packages/PETSc/petsc-2.3.3-p8"</li><li>If you have MPICH2 version 1.0.7 or greater edit the python/BuildSystem/config/packages/MPI.py file. Find the self.liblist_mpich line. After the line "['fmpich2.lib','mpich2.lib']," add the line "['fmpich2.lib','mpi.lib'],".</li><li><code class="code">PETSC_DIR=/cygdrive/e/opencmissextras/cm/external/packages/PETSc/petsc-2.3.3-p8; export PETSC_DIR</code></li><li><p>For a debug install issue the following commands</p><code class="code">
              <p>PETSC_ARCH=cygwin-c-debug; export PETSC_ARCH</p>
              <p>config/configure.py --prefix=/cygdrive/e/opencmissextras/cm/external/i386-win32-debug --with-shared=no --with-cc='win32fe cl' --with-fc='win32fe ifort' --with-cxx='win32fe cl' --download-f-blas-lapack=1 LIBS=-L'/cygdrive/c/Program\ Files/Intel/Compiler/Fortran/10.1.024/IA32/Lib' --with-debugging=yes</p>
            </code><p>For a non-debug install issue the following commands</p><code class="code">
              <p>PETSC_ARCH=cygwin-c-opt; export PETSC_ARCH</p>
              <p>config/configure.py --prefix=/cygdrive/e/opencmissextras/cm/external/i386-win32 --with-shared=no --with-cc='win32fe cl' --with-fc='win32fe ifort' --with-cxx='win32fe cl' --download-f-blas-lapack=1 LIBS=-L'/cygdrive/c/Program\ Files/Intel/Compiler/Fortran/10.1.024/IA32/Lib' --with-debugging=no</p>
            </code></li><li><code class="code">make -e all</code></li><li><code class="code">make -e install</code></li></ul></div></div></div></div></div><div class="navfooter"><hr /><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch02.xhtml">Prev</a> </td><td align="center" width="20%"> </td><td align="right" width="40%"> <a accesskey="n" href="ch04.xhtml">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Chapter 2. OpenCMISS Concepts </td><td align="center" width="20%"><a accesskey="h" href="index.xhtml">Home</a></td><td valign="top" align="right" width="40%"> Chapter 4. Object Interface</td></tr></table></div></body></html>